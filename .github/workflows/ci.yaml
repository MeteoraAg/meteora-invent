name: CI
on:
  pull_request:
  push:
    branches: [ main, fix/** ]
env:
  CI: true
  NEXT_TELEMETRY_DISABLED: 1
  RPC_ENDPOINT: ${{ secrets.RPC_URL }}
  NEXT_PUBLIC_RPC_URL: ${{ secrets.RPC_URL }}
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: 20
      - uses: pnpm/action-setup@v4
        with:
          version: 10.14.0
          name: CI
          on:
            pull_request:
            push:
              branches: [ main, fix/** ]
          env:
            CI: true
            NEXT_TELEMETRY_DISABLED: 1
            RPC_ENDPOINT: ${{ secrets.RPC_URL }}
            NEXT_PUBLIC_RPC_URL: ${{ secrets.RPC_URL }}
          jobs:
            build:
              runs-on: ubuntu-latest
              steps:
                - uses: actions/checkout@v4
                - uses: actions/setup-node@v4
                  with: { node-version: 20 }
                - uses: pnpm/action-setup@v4
                  with: { version: 10.14.0, run_install: true }
                - name: Fallback to public RPC if secret missing
                  if: ${{ !env.RPC_ENDPOINT }}
                  run: |
                    echo "RPC_ENDPOINT=https://api.mainnet-beta.solana.com" >> $GITHUB_ENV
                    echo "NEXT_PUBLIC_RPC_URL=https://api.mainnet-beta.solana.com" >> $GITHUB_ENV
                - name: Typecheck
                  run: pnpm -w exec tsc --noEmit
                - name: Lint
                  run: pnpm -w exec eslint . --ext .ts,.tsx,.js --max-warnings=0
                - name: Build
                  run: pnpm -w build
